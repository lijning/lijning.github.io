<!DOCTYPE html>
    <html>
    <head>
        <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
        <style>
/*--------------------------------------------------------------------------------------------- * Copyright (c) Microsoft Corporation. All rights reserved. * Licensed under the MIT License. See License.txt in the project root for license information. *--------------------------------------------------------------------------------------------*/ body { font-family: "Segoe WPC", "Segoe UI", "SFUIText-Light", "HelveticaNeue-Light", sans-serif, "Droid Sans Fallback"; font-size: 14px; padding: 0 12px; line-height: 22px; word-wrap: break-word; } body.scrollBeyondLastLine { margin-bottom: calc(100vh - 22px); } body.showEditorSelection .code-line { position: relative; } body.showEditorSelection .code-active-line:before, body.showEditorSelection .code-line:hover:before { content: ""; display: block; position: absolute; top: 0; left: -12px; height: 100%; } body.showEditorSelection li.code-active-line:before, body.showEditorSelection li.code-line:hover:before { left: -30px; } .vscode-light.showEditorSelection .code-active-line:before { border-left: 3px solid rgba(0, 0, 0, 0.15); } .vscode-light.showEditorSelection .code-line:hover:before { border-left: 3px solid rgba(0, 0, 0, 0.40); } .vscode-dark.showEditorSelection .code-active-line:before { border-left: 3px solid rgba(255, 255, 255, 0.4); } .vscode-dark.showEditorSelection .code-line:hover:before { border-left: 3px solid rgba(255, 255, 255, 0.60); } .vscode-high-contrast.showEditorSelection .code-active-line:before { border-left: 3px solid rgba(255, 160, 0, 0.7); } .vscode-high-contrast.showEditorSelection .code-line:hover:before { border-left: 3px solid rgba(255, 160, 0, 1); } img { max-width: 100%; max-height: 100%; } a { color: #4080D0; text-decoration: none; } a:focus, input:focus, select:focus, textarea:focus { outline: 1px solid -webkit-focus-ring-color; outline-offset: -1px; } hr { border: 0; height: 2px; border-bottom: 2px solid; } h1 { padding-bottom: 0.3em; line-height: 1.2; border-bottom-width: 1px; border-bottom-style: solid; } h1, h2, h3 { font-weight: normal; } h1 code, h2 code, h3 code, h4 code, h5 code, h6 code { font-size: inherit; line-height: auto; } a:hover { color: #4080D0; text-decoration: underline; } table { border-collapse: collapse; } table > thead > tr > th { text-align: left; border-bottom: 1px solid; } table > thead > tr > th, table > thead > tr > td, table > tbody > tr > th, table > tbody > tr > td { padding: 5px 10px; } table > tbody > tr + tr > td { border-top: 1px solid; } blockquote { margin: 0 7px 0 5px; padding: 0 16px 0 10px; border-left: 5px solid; } code { font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback"; font-size: 14px; line-height: 19px; } body.wordWrap pre { white-space: pre-wrap; } .mac code { font-size: 12px; line-height: 18px; } code > div { padding: 16px; border-radius: 3px; overflow: auto; } /** Theming */ .vscode-light { color: rgb(30, 30, 30); } .vscode-dark { color: #DDD; } .vscode-high-contrast { color: white; } .vscode-light code { color: #A31515; } .vscode-dark code { color: #D7BA7D; } .vscode-light code > div { background-color: rgba(220, 220, 220, 0.4); } .vscode-dark code > div { background-color: rgba(10, 10, 10, 0.4); } .vscode-high-contrast code > div { background-color: rgb(0, 0, 0); } .vscode-high-contrast h1 { border-color: rgb(0, 0, 0); } .vscode-light table > thead > tr > th { border-color: rgba(0, 0, 0, 0.69); } .vscode-dark table > thead > tr > th { border-color: rgba(255, 255, 255, 0.69); } .vscode-light h1, .vscode-light hr, .vscode-light table > tbody > tr + tr > td { border-color: rgba(0, 0, 0, 0.18); } .vscode-dark h1, .vscode-dark hr, .vscode-dark table > tbody > tr + tr > td { border-color: rgba(255, 255, 255, 0.18); } .vscode-light blockquote, .vscode-dark blockquote { background: rgba(127, 127, 127, 0.1); border-color: rgba(0, 122, 204, 0.5); } .vscode-high-contrast blockquote { background: transparent; border-color: #fff; }
</style>
<style>
/* Tomorrow Theme */ /* http://jmblog.github.com/color-themes-for-google-code-highlightjs */ /* Original theme - https://github.com/chriskempson/tomorrow-theme */ /* Tomorrow Comment */ .hljs-comment, .hljs-quote { color: #8e908c; } /* Tomorrow Red */ .hljs-variable, .hljs-template-variable, .hljs-tag, .hljs-name, .hljs-selector-id, .hljs-selector-class, .hljs-regexp, .hljs-deletion { color: #c82829; } /* Tomorrow Orange */ .hljs-number, .hljs-built_in, .hljs-builtin-name, .hljs-literal, .hljs-type, .hljs-params, .hljs-meta, .hljs-link { color: #f5871f; } /* Tomorrow Yellow */ .hljs-attribute { color: #eab700; } /* Tomorrow Green */ .hljs-string, .hljs-symbol, .hljs-bullet, .hljs-addition { color: #718c00; } /* Tomorrow Blue */ .hljs-title, .hljs-section { color: #4271ae; } /* Tomorrow Purple */ .hljs-keyword, .hljs-selector-tag { color: #8959a8; } .hljs { display: block; overflow-x: auto; color: #4d4d4c; padding: 0.5em; } .hljs-emphasis { font-style: italic; } .hljs-strong { font-weight: bold; }
</style>
<style>
ul.contains-task-list { padding-left: 0; } ul ul.contains-task-list { padding-left: 40px; } .task-list-item { list-style-type: none; } .task-list-item-checkbox { vertical-align: middle; }
</style>
        <style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', 'HelveticaNeue-Light', 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
    </head>
    <body>
        <h1 id="">数据库技术</h1>
<h2 id="">一 绪论</h2>
<h3 id="">概念</h3>
<ul>
<li>信息：存储 加工 传递 再生</li>
<li>信息 = 数据 + 数据处理</li>
<li>数据库特点
<ul>
<li>集成性 共享性</li>
</ul>
</li>
</ul>
<h3 id="">数据库技术历史</h3>
<ul>
<li>人工管理阶段|1950s中期前
<ul>
<li>数据不保存；无专用软件；数据不共享（程序间）;不独立</li>
</ul>
</li>
<li>文件系统阶段|1950-60s,mid；
<ul>
<li>长期保存；相应管理软件(文件系统）；文件形式多样；</li>
<li>程序与数据部分独立，但仍然需要专门的转换</li>
</ul>
</li>
<li>数据库系统阶段|1960s,end-；
<ul>
<li>数据冗余度低，结构化强；</li>
<li>数据独立性（局部-整体；物理-程序）；</li>
<li>数据控制功能</li>
</ul>
</li>
</ul>
<h3 id="">数据库系统</h3>
<h4 id="">组成</h4>
<ul>
<li>数据库
<ul>
<li>长期存储|有组织（集成性）|可共享 的数据集合。</li>
</ul>
</li>
<li>用户
<ul>
<li>终端用户</li>
<li>应用程序员</li>
<li>数据库管理员
<ul>
<li>数据库设计</li>
<li>安全性(权限管理)与完整性定义</li>
<li>恢复数据库</li>
</ul>
</li>
</ul>
</li>
<li>DBMS（软件）
<ul>
<li>DDL DML 编译处理</li>
<li>系统运行控制</li>
<li>系统建立维护</li>
<li>数据字典</li>
</ul>
</li>
<li>硬件</li>
</ul>
<h4 id="">内部体系结构</h4>
<ul>
<li>概念模式 Schema:全体数据逻辑结构的抽象表示</li>
<li>外模式/子模式：个别用户使用的数据结构和特征（不唯一）</li>
<li>内模式：全体数据物理存储结构的描述，但不关心物理位置</li>
</ul>
<p>二级映像：逻辑和物理独立性</p>
<p>简化用户接口；安全保密；数据共享</p>
<h3 id="">数据库管理系统</h3>
<h4 id="">主要功能</h4>
<ul>
<li>数据定义 DDL</li>
<li>数据操纵 DManipulationL</li>
<li>运行管理
<ul>
<li>安全性控制</li>
<li>完整性控制</li>
<li>并发控制</li>
<li>数据恢复</li>
</ul>
</li>
<li>数据组织存储和管理
<ul>
<li>数据字典</li>
<li>用户数据</li>
</ul>
</li>
<li>建立和维护</li>
<li>数据通信
<ul>
<li>与其它软件系统之间</li>
</ul>
</li>
</ul>
<h3 id="">数据模型</h3>
<ul>
<li>数据结构
<ul>
<li>层次 网状 关系</li>
</ul>
</li>
<li>数据操作</li>
<li>约束条件</li>
</ul>
<h4 id="">信息世界的概念</h4>
<ul>
<li>实体 Entity</li>
<li>属性 Attribute [椭圆]
<ul>
<li>分量：某个取值</li>
</ul>
</li>
<li>实体型 Entity type： [矩形框]
<ul>
<li>学生（学号、姓名、性别）</li>
</ul>
</li>
<li>实体集 Entity Set</li>
<li>键 码 Key：唯一标识一个实体的属性集合</li>
<li>域 Domain：属性值的取值范围</li>
<li>联系：实体型之间 [菱形]
<ul>
<li>1:1 班级和班长</li>
<li>1:n 班级和学生</li>
<li>m:n 教师和学生</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>计算机</th>
<th>信息界</th>
<th>关系型</th>
</tr>
</thead>
<tbody>
<tr>
<td>字段</td>
<td>属性</td>
<td>属性</td>
</tr>
<tr>
<td>实体</td>
<td>记录</td>
<td>元组</td>
</tr>
<tr>
<td>实体集</td>
<td>文件</td>
<td>关系</td>
</tr>
</tbody>
</table>
<h4 id="">数据模型分类</h4>
<table>
<thead>
<tr>
<th>模型</th>
<th>名称</th>
<th>数据联系</th>
<th>缺点</th>
</tr>
</thead>
<tbody>
<tr>
<td>层次</td>
<td>Hierarchical</td>
<td>树结构</td>
<td>难表示多队多联系</td>
</tr>
<tr>
<td>网状</td>
<td>network</td>
<td>图结构</td>
<td>完整性约束弱；独立性差</td>
</tr>
<tr>
<td>关系</td>
<td>relational</td>
<td>二维表</td>
<td>存取路径不可见</td>
</tr>
</tbody>
</table>
<h2 id="">二 关系数据库</h2>
<h3 id="">关系理论</h3>
<ul>
<li>基数：域包含的值的个数，用m表示</li>
<li>笛卡尔积：n个域之间运算，结果是（元素）n元组的集合</li>
<li>关系 $D1\times D2$的任一（实际中只选取有意义的）子集称为定义在D1,D2上的2元关系
<ul>
<li>R(D1,D2)  n=2</li>
<li>关系的目或度 n</li>
<li>关系的基数 r 关系内元组个数</li>
<li>关系头：属性名的集合</li>
<li>关系提：数据内容</li>
</ul>
</li>
<li>关系性质
<ul>
<li>元组不重复</li>
<li>顺序不相干（元组或属性）</li>
<li>同属性的各个属性值，域相同</li>
<li>各个属性，名字相异</li>
<li>每个分量是不可分的数据项：属性原子性
<ul>
<li>规范化关系的基准</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="">关系的码</h3>
<ul>
<li>候选码 Candidate key： 属性集
<ul>
<li>唯一性</li>
<li>最小性</li>
</ul>
</li>
<li>主关系键|主码|关键字：选自候选码
<ul>
<li>主属性：包含在主码内</li>
<li>非主属性：不包含于任何候选码</li>
<li>全码 all-key：所有属性的组合是候选码</li>
</ul>
</li>
<li>参照关系 referencing relation
<ul>
<li>R2参照R1:R2的属性C，不是R2主码，是R1主码</li>
<li>X为R1的外部关系键|外码</li>
</ul>
</li>
</ul>
<h3 id="">关系模型完整性</h3>
<ul>
<li>实体完整性 Entity Integrity:主码值均不为空</li>
<li>参照完整性 Referential：外码取参照的主码中的值或者控制</li>
<li>用户定义完整性：语义要求</li>
</ul>
<h3 id="">关系数据库模式</h3>
<ul>
<li>关系模式 relation schema: R(U,D,Dom,F)
<ul>
<li>关系名</li>
<li>D 属性集合</li>
<li>Dom 属性向域的映像集合</li>
<li>属性间依赖关系</li>
</ul>
</li>
<li>关系数据库
<ul>
<li>型：模式</li>
<li>值：内容</li>
</ul>
</li>
</ul>
<h3 id="">关系代数</h3>
<ul>
<li>集合运算
<ul>
<li>并； 差； 笛卡尔积</li>
</ul>
</li>
<li>关系概念
<ul>
<li>$t[A_i]$ 元组t相应于属性A_i的一个分量</li>
<li>连接</li>
<li>象集</li>
</ul>
</li>
<li>关系运算
<ul>
<li>选择：按条件选择元组</li>
<li>投影：选择属性列组成新关系(select distinct)</li>
<li>连接：在笛卡尔积上选取满足条件的子集</li>
<li>除法：R(X,Y)÷S(W,Z)
<ul>
<li>W与Y域相同</li>
<li>选取X的某些值x，x对应的各元组中的y集合包含W的全部y值</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="sql">三 SQL</h2>
<h3 id="">数据类型</h3>
<ul>
<li>NUMERIC(P,[S]) 精度P（总位数） 小数位数S</li>
<li>CHAR(N) 长度N</li>
</ul>
<h3 id="">创建用户</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">create</span>|<span class="hljs-keyword">alter</span> <span class="hljs-keyword">user</span> &lt;uname&gt; <span class="hljs-keyword">identified</span> <span class="hljs-keyword">by</span> &lt;<span class="hljs-keyword">password</span>&gt;
<span class="hljs-keyword">drop</span> <span class="hljs-keyword">user</span> &lt;uname&gt;
</div></code></pre>
<h3 id="">建表语句和相关约束</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> S
(SNO <span class="hljs-built_in">CHAR</span>(<span class="hljs-number">6</span>) ,
SN <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">UNIQUE</span>,<span class="hljs-comment">--只允许一个空值</span>
AGE <span class="hljs-built_in">INT</span> <span class="hljs-keyword">CONSTRAINT</span> CONS1 <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
SEX <span class="hljs-built_in">CHAR</span>(<span class="hljs-number">2</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'男'</span>, <span class="hljs-comment">--DEFAULT 默认值</span>
DEPT <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">20</span>),
PRIMARY <span class="hljs-keyword">KEY</span>(SNO,DEPT));
</div></code></pre>
<p>约束名称省略时，系统会自动生成一个。</p>
<pre class="hljs"><code><div><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> R
(SNO <span class="hljs-built_in">CHAR</span>(<span class="hljs-number">6</span>) <span class="hljs-keyword">CONSTRAINT</span> CONS2 <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> PRIMARY <span class="hljs-keyword">KEY</span>,
SNA <span class="hljs-built_in">CHAR</span>(<span class="hljs-number">10</span>) FOREIGN <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">REFERENCES</span> S(SN),
AGE <span class="hljs-built_in">NUMERIC</span>(<span class="hljs-number">2</span>,<span class="hljs-number">0</span>) <span class="hljs-keyword">CHECK</span>(SCORE&gt;<span class="hljs-number">0</span>));<span class="hljs-comment">--CHECK既能作表约束也可作列约束</span>
</div></code></pre>
<p><code>从表</code>：包含外码；<code>主表</code>：包含从表所引用的主码。</p>
<h3 id="">修改删除基本表</h3>
<p>ADD方式：增加新列（自动填充NULL值）或完整性约束</p>
<pre class="hljs"><code><div><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> S
<span class="hljs-keyword">ADD</span> (CLASS_NO <span class="hljs-built_in">CHAR</span>(<span class="hljs-number">6</span>),
     ADDR <span class="hljs-built_in">CHAR</span>(<span class="hljs-number">40</span>));<span class="hljs-comment">--NOT NULL不可用</span>
</div></code></pre>
<pre class="hljs"><code><div><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> SC
<span class="hljs-keyword">ADD</span> <span class="hljs-keyword">CONSTRAINT</span> SCORE_CHK
<span class="hljs-keyword">CHECK</span> (SCORE <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">0</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">100</span>);
</div></code></pre>
<p>ALTER方式：修改某些列</p>
<pre class="hljs"><code><div><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> S
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">COLUMN</span><span class="hljs-comment">--不能修改列名或减少数据宽度</span>
(SNO <span class="hljs-built_in">CHAR</span>(<span class="hljs-number">8</span>) <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>);<span class="hljs-comment">--只能改NULL约束</span>
</div></code></pre>
<p>DROP方式：删除完整性约束</p>
<pre class="hljs"><code><div><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> S <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">CONSTRAINT</span> AGE_CHK;
</div></code></pre>
<p>删除表：索引随之删除，视图会保留但不可用。</p>
<pre class="hljs"><code><div><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> S;
</div></code></pre>
<h3 id="">索引</h3>
<ul>
<li>数据库随机检索手段</li>
<li>记录关键字与相应地址的对应表</li>
<li>作用
<ul>
<li>加快查询速度</li>
<li>保证行的唯一性</li>
</ul>
</li>
<li>聚集索引（没有另建，只是排序）与非聚蔟索引（排列结果另外存储）
<ul>
<li>一张表只能有一个CLUSTER索引</li>
</ul>
</li>
<li>唯一索引：每个索引值对应唯一记录
<ul>
<li>UNIQUE约束:自动建立非聚集的； PRIMARY KEY：建立聚集的</li>
<li>有重复值时不能建立</li>
</ul>
</li>
<li>复合索引：基于多个字段</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">CREATE</span> [<span class="hljs-keyword">UNIQUE</span>] [CLUSTER] <span class="hljs-keyword">INDEX</span> SCI <span class="hljs-keyword">ON</span> SC(SNO [<span class="hljs-keyword">ASC</span>],CNO[<span class="hljs-keyword">DESC</span>]);
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">INDEX</span> SC.SCI;
</div></code></pre>
<h3 id="">查询</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">SELECT</span> [&lt;all|top n|<span class="hljs-keyword">distinct</span><span class="hljs-comment">/*去重*/</span>&gt;]&lt;列名[<span class="hljs-keyword">AS</span> 别名<span class="hljs-number">1</span><span class="hljs-comment">/*查询时只显示别名*/</span>]&gt;[{,&lt;列名[<span class="hljs-keyword">AS</span> 别名<span class="hljs-number">2</span>]&gt;}]
<span class="hljs-keyword">FROM</span>〈表名或视图名〉[{,&lt;表名或视图名&gt;}] [<span class="hljs-keyword">AS</span> 别名<span class="hljs-number">3</span>]
[<span class="hljs-keyword">WHERE</span>〈检索条件〉] <span class="hljs-comment">-- 对元组的限制</span>
[<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> &lt;列名<span class="hljs-number">1</span>&gt;[<span class="hljs-keyword">HAVING</span> &lt;条件表达式&gt;]] <span class="hljs-comment">-- 对聚集后的关系的限制</span>
[<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> &lt;列名<span class="hljs-number">2</span>&gt;[<span class="hljs-keyword">ASC</span>|<span class="hljs-keyword">DESC</span>]]; <span class="hljs-comment">-- 默认升序</span>
</div></code></pre>
<ul>
<li>执行过程
<ol>
<li>选取满足WHERE的元组</li>
<li>投影SELECT指定的列，得到结果表</li>
<li>分组；排序</li>
</ol>
</li>
</ul>
<h4 id="">条件查询</h4>
<table>
<thead>
<tr>
<th>类别</th>
<th>符号</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>比较运算符</td>
<td>= != &gt; &lt;=</td>
<td></td>
</tr>
<tr>
<td>逻辑运算符</td>
<td>AND OR NOT</td>
<td></td>
</tr>
<tr>
<td>确定范围</td>
<td>BETWEEN AND</td>
<td>闭区间</td>
</tr>
<tr>
<td>空值</td>
<td>IS NULL</td>
<td>&lt;属性名&gt;=NULL不合法</td>
</tr>
<tr>
<td>字符匹配</td>
<td>&lt;属性名&gt;LIKE&lt;字符串常量&gt;</td>
<td>通配符：%任意长度 _单个字符</td>
</tr>
<tr>
<td>确定集合</td>
<td>IN ('C1','C2')</td>
<td>括号即集合</td>
</tr>
</tbody>
</table>
<p>ESCAPE ‘&lt;换码字符&gt;’：自定义转义字符</p>
<pre class="hljs"><code><div><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> T <span class="hljs-keyword">WHERE</span> TN <span class="hljs-keyword">LIKE</span>
 ‘MC\_%’ ESCAPE ‘\’; <span class="hljs-comment">/*  \ 是转义字符  */</span>
</div></code></pre>
<h4 id="">常用库函数与分组查询</h4>
<p>AVG() SUM() MIN() MAX() COUNT()</p>
<pre class="hljs"><code><div><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> DEPT) <span class="hljs-keyword">AS</span> DeptNum <span class="hljs-keyword">FROM</span> S;
<span class="hljs-comment">/* 不计算重复行 */</span>
</div></code></pre>
<ul>
<li>COUNT(&lt;属性名&gt;) 不计空值</li>
<li>COUNT(*) 元组个数</li>
</ul>
<h4 id="">结果排序</h4>
<pre class="hljs"><code><div>ORDER BY SUM(SCORE) DESC <span class="hljs-comment">-- 错误</span>
ORDER BY 2 DESC <span class="hljs-comment">-- '2'代表查询结果的第二列</span>
</div></code></pre>
<h4 id="">数据表连接</h4>
<h5 id="join">JOIN关键字</h5>
<pre class="hljs"><code><div><span class="hljs-keyword">SELECT</span> T.TNO,TN,CNO
<span class="hljs-keyword">FROM</span> T <span class="hljs-keyword">JOIN</span> TC <span class="hljs-comment">-- 默认INNER JOIN</span>
<span class="hljs-keyword">ON</span> T.TNO=TC.TNO <span class="hljs-keyword">AND</span> T.TN=<span class="hljs-string">'刘伟'</span>
<span class="hljs-comment">/*或者*/</span>
<span class="hljs-keyword">SELECT</span> R2.TNO,R2.TN, R1.CNO <span class="hljs-keyword">FROM</span>
(<span class="hljs-keyword">SELECT</span> TNO,CNO <span class="hljs-keyword">FROM</span> TC ) <span class="hljs-keyword">AS</span> R1
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> (<span class="hljs-keyword">SELECT</span> TNO ,TN <span class="hljs-keyword">FROM</span> T
<span class="hljs-keyword">WHERE</span> TN=<span class="hljs-string">'刘伟'</span>) <span class="hljs-keyword">AS</span> R2 <span class="hljs-keyword">ON</span> R1.TNO=R2.TNO
</div></code></pre>
<p>FROM可以跟SELECT结果</p>
<h5 id="">自身连接</h5>
<pre class="hljs"><code><div><span class="hljs-keyword">SELECT</span> X.TN, X.SAL, Y.SAL <span class="hljs-comment">-- 找出比刘伟工资高的老师</span>
<span class="hljs-keyword">FROM</span> T <span class="hljs-keyword">AS</span> X ,T <span class="hljs-keyword">AS</span> Y <span class="hljs-comment">-- 同一个表的两个别名</span>
<span class="hljs-keyword">WHERE</span> X.SAL&gt;Y.SAL <span class="hljs-keyword">AND</span> Y.TN=‘刘伟’；
</div></code></pre>
<h4 id="">嵌套查询</h4>
<p>外部查询|父查询 的WHERE子句 包含 嵌套查询|子查询</p>
<ul>
<li>最高255层</li>
<li>由内向外处理</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-comment">/* 子查询返回一组值 */</span>
WHERE &lt;&gt; = ANY(子查询)
<span class="hljs-comment">/* 或者 */</span>WHERE &lt;&gt; IN (子查询)

WHERE SAL &gt; ALL(子查询) <span class="hljs-comment">-- 等价于子查询选择最大值</span>

 !=ALL(子查询) <span class="hljs-comment">/*等价于*/</span> NOT IN (子查询)
</div></code></pre>
<ul>
<li>相关子查询：子查询条件中引用父查询表的属性值</li>
<li>执行顺序
<ul>
<li>选取父查询表的第一行，子查询利用此值计算</li>
<li>父查询据子查询结果判断第一行是否满足条件</li>
<li>下一行</li>
</ul>
</li>
<li>存在量词 EXIST 返回逻辑值 T/F</li>
</ul>
<h3 id="">数据更新</h3>
<h4 id="">插入</h4>
<p>省略列名（此时新纪录必须在每个属性上均有值）</p>
<pre class="hljs"><code><div><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> S <span class="hljs-keyword">VALUES</span>(‘s7’,‘郑冬’,‘女’,<span class="hljs-number">21</span>,‘计算机’)
</div></code></pre>
<p>指定列名（部分列）</p>
<pre class="hljs"><code><div><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> SC (SNO,CNO)
<span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'s7'</span>, <span class="hljs-string">'c1'</span>);
</div></code></pre>
<p>插入多行（利用子查询的表间复制）</p>
<pre class="hljs"><code><div><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> AVGSAL
<span class="hljs-keyword">SELECT</span> DEPT,<span class="hljs-keyword">AVG</span>(SAL) <span class="hljs-keyword">FROM</span> T
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> DEPT ;
</div></code></pre>
<h4 id="">修改</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">UPDATE</span> &lt;表名&gt;
<span class="hljs-keyword">SET</span> &lt;列名&gt;=&lt;表达式&gt; [,&lt;列名&gt;=&lt;表达式&gt;]
[<span class="hljs-keyword">WHERE</span> &lt;条件&gt;]
</div></code></pre>
<p>表达式可以是常量，基于属性的运算，或子查询的结果。</p>
<h4 id="">删除</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> TC  <span class="hljs-comment">--注意：两个关键字连用</span>
<span class="hljs-keyword">WHERE</span> TNO=(<span class="hljs-keyword">SELECT</span> TNO
<span class="hljs-keyword">FROM</span> T  <span class="hljs-keyword">WHERE</span> TN=‘刘伟’);
</div></code></pre>
<h3 id="">视图</h3>
<ul>
<li>记录来自基本表，只有定义被存储。</li>
<li>用户可在视图上再定义视图或进行查删改操作
<ul>
<li>单表定义的才可以更新，有计算或连接的不行。</li>
</ul>
</li>
<li>作用：
<ul>
<li>数据保密，限制访问</li>
<li>简化复杂的查询操作</li>
<li>保证外模式与模式的逻辑独立性</li>
</ul>
</li>
</ul>
<h4 id="">定义和删除视图</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> &lt;视图名&gt;[(&lt;视图列表&gt;)] <span class="hljs-keyword">AS</span> &lt;子查询&gt;
</div></code></pre>
<ul>
<li>视图列表是视图当中的列名，可由子查询中的AS子句给定</li>
<li>子查询中ORDER BY子句和 DISTINCT短语禁用</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">VIEW</span> SUB_T;  <span class="hljs-comment">--删除</span>
</div></code></pre>
<p>删除视图后，其导出视图不会删除，但它们已无意义。</p>
<h4 id="">视图消解</h4>
<ul>
<li>View Resolution</li>
<li>对视图执行查询时，系统会将数据字典中的视图定义和用户查询结合。</li>
</ul>
<h3 id="data-control-language">数据控制 Data Control Language</h3>
<h4 id="">权限与角色</h4>
<table>
<thead>
<tr>
<th>概念</th>
<th>授予主体</th>
<th>权限范围</th>
</tr>
</thead>
<tbody>
<tr>
<td>系统权限</td>
<td>数据库管理员</td>
<td>比如，建表</td>
</tr>
<tr>
<td>对象权限</td>
<td>基本表或视图创建者</td>
<td>对数据库对象的操作</td>
</tr>
</tbody>
</table>
<p>角色：多种权限的集合；授给用户或其他角色</p>
<h5 id="">系统权限授予</h5>
<pre class="hljs"><code><div><span class="hljs-keyword">GRANT</span> &lt;权限&gt;|&lt;角色&gt; [,&lt;权限&gt;|&lt;角色&gt;] <span class="hljs-comment">-- 如"CREATE TABLE"</span>
<span class="hljs-keyword">TO</span> &lt;用户名&gt;|&lt;角色&gt;|<span class="hljs-keyword">PUBLIC</span>[,&lt;用户名&gt;|&lt;角色&gt;] <span class="hljs-comment">--public代表全体用户</span>
[<span class="hljs-keyword">WITH</span> <span class="hljs-keyword">ADMIN</span> <span class="hljs-keyword">OPTION</span>] <span class="hljs-comment">--允许转授</span>
</div></code></pre>
<h5 id="">对象权限授予</h5>
<pre class="hljs"><code><div><span class="hljs-keyword">GRANT</span> ALL|&lt;权限&gt;[(列名[,列名])][,&lt;权限&gt;]
<span class="hljs-keyword">ON</span> &lt;对象名&gt; <span class="hljs-comment">-- 基本表或视图</span>
<span class="hljs-keyword">TO</span> &lt;用户名&gt;|&lt;角色&gt;|<span class="hljs-keyword">PUBLIC</span>[,&lt;用户名&gt;|&lt;角色&gt;]
[<span class="hljs-keyword">WITH</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">OPTION</span>]
</div></code></pre>
<p>只有SELECT INSERT UPDATE才需要指定列名</p>
<h5 id="">对象权限收回</h5>
<pre class="hljs"><code><div><span class="hljs-keyword">REVOKE</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">ON</span> C <span class="hljs-keyword">FROM</span> USER1
</div></code></pre>
<h2 id="">四 关系数据库规范化理论</h2>
<p>关系以五元组 R(U 属性名,D 属性的域,DOM 属性向域的映象集合,F 属性间数据的依赖关系集合) 表示</p>
<h3 id="1nf">第一范式 1NF</h3>
<p>每一个分量是不可分的数据项</p>
<h4 id="">存在问题</h4>
<ul>
<li>数据冗余</li>
<li>更新异常 Update Anomalies</li>
<li>插入异常 Insertion</li>
<li>删除异常</li>
</ul>
<h3 id="">数据依赖</h3>
<p>关系内部，属性与属性之间的依赖关系</p>
<ul>
<li>多值依赖</li>
<li>函数依赖 X→Y
<ul>
<li>X函数确定Y Y函数依赖于X</li>
<li>平凡与非平凡</li>
<li>完全与部分：Y是否依赖于X的真子集</li>
<li>传递与直接</li>
<li>基本性质
<ul>
<li>投影 扩张 合并 分解</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>主属性Prime Attribute：包含在任何一个候选码中的属性。</p>
<p>外部码Foreign Key：是另一个关系模式的码。</p>
<h3 id="">第二范式</h3>
<p>非主属性完全依赖于码；仍然存在四种异常</p>
<ul>
<li>2NF规范化
<ul>
<li>投影分解，不完全依赖的属性，新的关系。</li>
<li>基本原则：一事一地 （一个关系只描述一个实体或联系）</li>
</ul>
</li>
</ul>
<h3 id="bc">BC范式</h3>
<p>2NF与3NF没有限制主属性对主码的依赖关系</p>
<ol>
<li>所有非主属性对每一个码都是完全函数依赖</li>
<li>所有主属性，对不包含它的码，完全函数依赖</li>
<li>没有属性完全函数依赖于非码属性组</li>
</ol>
<table>
<thead>
<tr>
<th>范式</th>
<th>要点</th>
</tr>
</thead>
<tbody>
<tr>
<td>2NF</td>
<td>非主属性完全依赖于码</td>
</tr>
<tr>
<td>3NF</td>
<td>非主属性不存在传递依赖</td>
</tr>
<tr>
<td>BCNF</td>
<td>决定属性组都包含码</td>
</tr>
</tbody>
</table>
<ul>
<li>函数依赖保持性</li>
<li>无损连接性</li>
</ul>
<h2 id="">五 数据库安全保护</h2>
<h3 id="">数据库安全性</h3>
<p>防止非法使用造成数据泄露更改或破坏：控制访问策略</p>
<h4 id="identification-and-authentication">用户标识和鉴定 Identification and Authentication</h4>
<ul>
<li>用户名与口令</li>
<li>授权表
<ul>
<li>数据字典当中</li>
<li>用户标识 &amp; 数据对象 &amp; 操作类型</li>
</ul>
</li>
<li>授权粒度
<ul>
<li>关系 记录 属性 数值
<ul>
<li>存取谓词的操作：DEPT=‘计算机’</li>
</ul>
</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>对象</th>
<th>操作类型</th>
</tr>
</thead>
<tbody>
<tr>
<td>模式</td>
<td>内 外 模式</td>
</tr>
<tr>
<td>数据</td>
<td>表 属性列</td>
</tr>
</tbody>
</table>
<h4 id="">定义视图</h4>
<h4 id="data-encryption">数据加密 Data Encryption</h4>
<p>替换 | 转换</p>
<h4 id="audit">审计 Audit</h4>
<p>监视跟踪有关数据的访问活动 记录位于Audit log</p>
<pre class="hljs"><code><div>AUDIT <span class="hljs-keyword">SELECT</span>, <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">ON</span> TABLE_S <span class="hljs-keyword">WHENEVER</span> SUCCESSFULL
<span class="hljs-keyword">NO</span> <span class="hljs-keyword">AUDIT</span> <span class="hljs-keyword">ON</span> TABLE_S
</div></code></pre>
<h3 id="">完整性控制</h3>
<p>保护数据正确有效相容</p>
<ul>
<li>按对象粒度分类
<ul>
<li>列级约束</li>
<li>元组约束
<ul>
<li>发货量不得超过订货量</li>
</ul>
</li>
<li>关系级
<ul>
<li>函数依赖：同一关系不同属性间</li>
<li>实体完整性和参照完整性（两个不变性）</li>
<li>统计约束
<ul>
<li>系主任奖金不得高于该系平均奖金</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>静态约束和动态约束</li>
</ul>
<h4 id="">完整性规则</h4>
<ul>
<li>五元组(Data,O 用户操作,Assertion 语义约束,Condition 哪些元组,Procedure)</li>
<li>触发条件
<ul>
<li>立即执行 Immediate Constrains：某一语句完成后</li>
<li>延迟执行 Defferred : 整个事务结束后提交前</li>
</ul>
</li>
<li>约束条件</li>
<li>违约响应</li>
</ul>
<h3 id="">并发控制</h3>
<h4 id="transaction">事务 Transaction</h4>
<p>一组操作序列</p>
<pre class="hljs"><code><div><span class="hljs-keyword">BEGIN</span> <span class="hljs-keyword">TRANSACTION</span>
<span class="hljs-keyword">COMMIT</span> <span class="hljs-comment">-- 只有在此之后，事务对数据库造成的变动才对其他事务开放</span>
<span class="hljs-keyword">ROLLBACK</span>
</div></code></pre>
<ul>
<li>原子性 Atomic</li>
<li>一致性 Consistency：满足完整性约束</li>
<li>隔离性 Isolation</li>
<li>持续性 Durability</li>
</ul>
<h4 id="">并发操作导致数据的不一致性</h4>
<ul>
<li>丢失更新 Lost Update： 更新结果被另一事务覆盖</li>
<li>读脏数据 Dirty Read： 读取数据后，数据被回滚</li>
<li>不可重读 Unrepeatable Read：核对数据时</li>
</ul>
<h4 id="lock-timestamping">控制技术：Lock &amp; Timestamping</h4>
<ul>
<li>封锁类型
<ul>
<li>排他锁 X：其他事务无法加锁</li>
<li>共享锁 S：允许其他事务的查询</li>
</ul>
</li>
<li>封锁协议 Loct Protocol
<ul>
<li>一级：修改前加X锁直到事务结束，读取数据不用加锁</li>
<li>二级：读取数据期间加S锁</li>
<li>三级：事务结束才释放S锁</li>
</ul>
</li>
<li>封锁粒度 Lock Granularity
<ul>
<li>字段 记录 表 数据库</li>
<li>权衡系统开销与并发度</li>
</ul>
</li>
<li>新问题
<ul>
<li>活锁 Live lock：某一事务总轮不到</li>
<li>死锁 Deadlock:双方抢占被对方锁住的数据
<ul>
<li>一次性加锁所有会用到的数据对象</li>
<li>所有对象有一个封锁顺序：A先于B，则某事务想要使用B资源，必须上锁A；反之不然。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="">数据库恢复</h3>
<h4 id="logging">登记日志 logging</h4>
<ul>
<li>内容
<ul>
<li>事务ID</li>
<li>操作类型</li>
<li>操作对象</li>
<li>新值旧值</li>
<li>关键时刻（事务起止回写时间点）</li>
</ul>
</li>
<li>原则（避免事务处理半途故障导致不可恢复）
<ul>
<li>登记按照并行事务执行次序</li>
<li>先写日志，后写数据库</li>
</ul>
</li>
</ul>
<h4 id="data-dump">数据转储 data dump</h4>
<p>定期将整个数据库复制到多个存储设备</p>
<ul>
<li>海量 与 增量转储（只转储更新过的数据）</li>
<li>静态（期间不允许数据存取活动） 与 动态转储（配合日志文件）</li>
</ul>
<h3 id="">数据库故障</h3>
<h4 id="">事务故障</h4>
<ul>
<li>非预期、不正常的程序结束造成</li>
<li>事务撤销 UNDO</li>
</ul>
<h4 id="">系统故障</h4>
<ul>
<li>所有运行中事务均非正常结束</li>
<li>原因：硬件错误/OS错误</li>
<li>事务的重做或撤销（区分于是否已经commit）</li>
</ul>
<h4 id="media-failure">介质故障 Media Failure</h4>
<p>辅助存储器介质遭到破坏</p>
<h2 id="">六 数据库设计</h2>
<h3 id="">设计的内容</h3>
<ul>
<li>结构设计
<ul>
<li>静态模型，各应用程序共享</li>
<li>概念 逻辑 物理</li>
</ul>
</li>
<li>行为设计
<ul>
<li>设计应用程序</li>
</ul>
</li>
</ul>
<h3 id="">设计步骤</h3>
<table>
<thead>
<tr>
<th>阶段</th>
<th>内容</th>
<th>工作</th>
</tr>
</thead>
<tbody>
<tr>
<td>系统需求分析</td>
<td></td>
<td>数据流图与数据字典</td>
</tr>
<tr>
<td>概念结构设计</td>
<td></td>
<td>E-R图</td>
</tr>
<tr>
<td>逻辑结构设计</td>
<td>具体到某个DBMS</td>
<td></td>
</tr>
<tr>
<td>物理设计</td>
<td>存储结构与存取方法</td>
<td>建表</td>
</tr>
<tr>
<td>数据库实施</td>
<td></td>
<td>装入原始数据</td>
</tr>
<tr>
<td>运行与维护</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="er">ER图</h3>
<table>
<thead>
<tr>
<th>成分</th>
<th>图形</th>
<th>标注</th>
</tr>
</thead>
<tbody>
<tr>
<td>实体</td>
<td>矩形框</td>
<td></td>
</tr>
<tr>
<td>属性</td>
<td>椭圆形</td>
<td></td>
</tr>
<tr>
<td>联系</td>
<td>菱形</td>
<td></td>
</tr>
</tbody>
</table>
<p>类型，如m:n ——分别标在该联系连接到实体的两条无向边上</p>

    </body>
    </html>